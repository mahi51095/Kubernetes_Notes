
# ğŸŒ Kubernetesâ€¯Clusterâ€¯Setupâ€¯Guide  
*A DevOpsâ€‘oriented annotated version*  

---

## ğŸ§± Kubernetesâ€¯Clusterâ€¯Types  

### 1. Selfâ€‘Managed Kubernetes Cluster  

| Item | **Definition** | **DevOps âœ What & Why** |
|------|----------------|--------------------------|
| **Minikube** | A singleâ€‘node Kubernetes distribution that runs locally inside a VM or container. | â€¢ Fast spinâ€‘up for POCs and demos. <br>â€¢ Lets DevOps engineers prototype manifests exactly as they would run in productionâ€”no â€œitâ€‘worksâ€‘onâ€‘myâ€‘laptopâ€ surprises. |
| **Kubeadm** | The CNCFâ€‘supported CLI tool that bootstraps a multiâ€‘node cluster by generating certificates, kubeâ€‘configs, and controlâ€‘plane manifests. | â€¢ Declarative, versionâ€‘consistent cluster creation (immutable infra). <br>â€¢ Guarantees repeatability when rebuilding or scaling clusters in lab or edge environments. |

> ğŸ’¡ **Selfâ€‘managed:** *You* own the control plane. Great for fineâ€‘grained control and airâ€‘gapped or costâ€‘conscious setups, but you must patch, upgrade, and back up etcd yourself.

---

### 2. Cloudâ€‘Managed Kubernetes Cluster  

| Cloud | **Managed Service** | **Definition & DevOps Benefits** |
|-------|--------------------|----------------------------------|
| AWS   | **EKS** | Fully managed control plane; IAMâ€‘integrated RBAC and builtâ€‘in scalability tooling (Karpenter/Fargate). DevOps teams focus on app delivery, not cluster care. |
| Azure | **AKS** | Azure AD authentication, automated patching, plus builtâ€‘in CI/CD hooks via Azure DevOps and GitHubâ€¯Actions. Simplifies governance for enterprises already on Microsoft stack. |
| GCP   | **GKE** | Googleâ€‘hardened master, autoâ€‘upgrades, and binary authorization. Popular for SRE teams adopting Googleâ€™s same production practices. |

> ğŸ’¡ **Managed:** Cloud provider monitors the nodes, autoâ€‘heals them, and rolls out zeroâ€‘downtime upgradesâ€”reducing toil and onâ€‘call pages.

---

## ğŸ–¥ï¸ Clusterâ€¯Architecture Example  

| Role | **Definition** | **Why DevOps Cares** |
|------|----------------|----------------------|
| **Master / Control Plane** | Runs APIâ€¯server, scheduler, controllerâ€‘manager, etcd. | Central point for GitOps pipelinesâ€”everything declared here is the single source of truth. |
| **Worker Node** | Hosts application Pods and kubelet. | Scaling unit for horizontal growth; observability and resource quotas are applied perâ€‘node. |

Example layout: **1â€¯master + 2â€¯workers**â€”small yet productionâ€‘realistic lab for chaosâ€‘testing and upgrade rehearsals.

---

# ğŸ“Œ Agenda: *Kubeadm*â€¯â€‘â€‘> *AWSâ€¯EC2*â€¯â€‘â€‘> *containerd*  

The steps below are annotated with the *what* (definition) and *why* (DevOps rationale).

---

## ğŸ”§ Prerequisites  

| Resource | **Definition** | **Why (DevOps)** |
|----------|----------------|------------------|
| **UbuntuÂ 20.04/22.04** | LTS OS, predictable kernel & systemd. | Longâ€‘term support means fewer CVEs midâ€‘project. |
| **Masterâ€¯t2.medium** | 4â€¯GBâ€¯RAM, 2â€¯vCPU. | Controlâ€‘plane components are memoryâ€‘sensitive; underâ€‘provisioning = etcd crashes. |
| **Workerâ€¯t2.micro** | 1â€¯GBâ€¯RAM, 1â€¯vCPU (lab). | Mirrors lowâ€‘spec edge nodes; validates resource requests/limits. |
| **Open All Ports (lab)** | 0.0.0.0/0 in SG. | *Only* for throwâ€‘away demosâ€”ease of setup outweighs security. In prod youâ€™d lock this down with leastâ€‘privilege rules and private subnets. |

---

# âš™ï¸ Common Setup (MasterÂ & Workers)  

| Step | Snippet | **What / Why** |
|------|---------|----------------|
| 1ï¸âƒ£ `sudo su -` | Become root. | Reduces â€œpermission deniedâ€ friction during automation scripts. |
| 2ï¸âƒ£ Disableâ€¯swap | `swapoff â€‘a` | K8s scheduler assumes no swapping; prevents unpredictable latency. |
| 3ï¸âƒ£ Kernelâ€¯tuning | Enable `br_netfilter`, `ip_forward`. | Lets kubeâ€‘proxy & CNI manipulate iptables for Podâ€‘toâ€‘Pod traffic. |
| 4ï¸âƒ£ Install **containerd** | OCIâ€‘compliant CRI runtime. | Lightweight vs. Dockerâ€¯Engine; endorsed by KubernetesÂ v1.24+. |
| 5ï¸âƒ£ Install **kubelet, kubeadm, kubectl** | Core binaries pinned with `apt-mark hold`. | Version skew policy: nodes Â±1 minor from control plane; pinning avoids accidental upgrades that might break compatibility. |

---

# ğŸ‘‘ MasterÂ Node Tasks  

| Task | **Definition** | **Why (DevOps)** |
|------|----------------|------------------|
| `kubeadm init` | Generates certificates & manifests under `/etc/kubernetes`. | Automates TLS, RBAC, and etcd bootstrapâ€”errorâ€‘prone if done manually. |
| Configure `kubectl` | Copy adminâ€†kubeâ€‘config to `$HOME/.kube/config`. | Enables dayâ€‘one GitOps and CI/CD pipelines that use `kubectlâ€¯apply`. |
| **CNI Plugin** | Weaveâ€¯Net / Calico. | Provides overlay networking + NetworkPolicy enforcement; choice depends on feature set (Calico for eBPF, Weave for simplicity). |
| Clusterâ€¯verify | `kubectl get nodes/pods`. | Smoke test for observers and alerting baselines. |
| Joinâ€‘token | Printed with `kubeadm token create`. | Idempotent automationâ€”can be fed into Terraform/Ansible worker modules. |

---

# ğŸ‘· WorkerÂ Node Tasks  

Run the join command â†’ registers kubelet with APIâ€¯server, pulls PodÂ CIDR settings. **Why it matters:** Brings elasticityâ€”new capacity can be autoâ€‘provisioned by autoscaler events.

---

# ğŸ§ª SampleÂ App Deployment  

| Command | **What happens** | **Why (DevOps)** |
|---------|------------------|------------------|
| `kubectl run nginx-demo` | Creates a Pod with `nginx` image. | Quick sanity check that the container runtime, pull secrets, and DNS work. |
| `kubectl expose pod â€¦ --type=NodePort` | Service object gets a port on each node. | Mimics basic northâ€‘south traffic without needing an Ingress controller. |

---

# ğŸ“š Kubernetesâ€¯Resources (API Objects)  

| Kind | **Definition** | **DevOps Role** |
|------|----------------|-----------------|
| **Pod** | Smallest deployable unitâ€”1â€¯orâ€¯moreâ€¯containers. | Building block for higher abstractions (Deployments, Jobs). |
| **ReplicaSet** | Ensures a specified number of identical Pods. | Autoâ€‘healing & scaling driver behind Deployments. |
| **DaemonSet** | Guarantees 1â€¯Pod per node (e.g., log collectors). | Clusterâ€‘wide observability & security agents. |
| **Deployment** | Declarative updates for ReplicaSets. | Enables canary/blueâ€‘green via `kubectl rollout`. |
| **StatefulSet** | Ordered, sticky identifiers for Pods + PVCs. | Databases, queuesâ€”stable network IDs. |
| **Namespace** | Virtual cluster inside a cluster. | Multiâ€‘tenancy, RBAC boundaries, cost allocation. |
| **ConfigMap / Secret** | Externalize config and credentials. | Twelveâ€‘factor compliance & secret rotation. |
| **Service / Ingress** | Stable access endpoints + L7 routing. | Decouples service discovery from Pod lifecycles. |
| **PersistentVolumeClaim** | User request for storage with specific QoS. | Abstracts away underlying EBS, Ceph, NFS, etc. |

---

## ğŸ§¾ Handyâ€¯`kubectl` Cheatâ€‘sheet  

```bash
kubectl api-resources          # discover all Kinds
kubectl get nodes -o wide      # show OS/arch & taints
kubectl get pods -A -w         # watch all namespaces in realâ€‘time
```

> ğŸ§  **Tip:** Add `--context`, `--namespace`, and `--selector` flags to target GitOps pipelines precisely.

---

# ğŸ§© Namespaces Deepâ€‘Dive  

| Aspect | **Definition** | **Why (DevOps)** |
|--------|----------------|------------------|
| Isolation | Soft multiâ€‘tenancy boundary for names, quotas, and RBAC. | Prevents â€œnoisy neighborâ€ resource exhaustion and simplifies costâ€‘showback. |
| ResourceQuota | Limits CPU, memory, objects per NS. | Enforces SLOs and cost budgets automatically. |
| Context Switching | `kubectl config set-context â€¦` | Avoids the classic â€œoops I deployed to prodâ€ problem in CI jobs. |

Example **Namespace manifest** and **ResourceQuota** shown aboveâ€”ideal for IaC repos.

---

## ğŸ WrappingÂ Up  

- **Selfâ€‘managed vs. Cloudâ€‘managed**: choose based on control vs. operational overhead.  
- **containerd + kubeadm**: minimalistic, CNCFâ€‘aligned stackâ€”perfect for repeatable DevOps pipelines.  
- **Namespaces, RBAC, Quotas**: invisible heroes that turn â€œa bunch of VMsâ€ into a multiâ€‘tenant PaaS.  

> ğŸš€ **Next steps:**  
> 1. Script these commands with Ansible or Terraform.  
> 2. Add GitOps via Argoâ€¯CD or Flux.  
> 3. Integrate CI triggers (e.g., GitHubâ€¯Actions â†’ `kubectl apply`).  

Happy shipping! âœ¨

---

### ğŸ™‹ Support  
**KKâ€¯FUNDA**  
ğŸ“Â 863980177 /Â 9676831734
